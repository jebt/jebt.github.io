var particleBuffer,noiseMap,particleBufferSize=30,CircularBuffer=function(a){this.buffer=Array(a);this.size=a;this.length=this.tail=this.head=0};CircularBuffer.prototype.push=function(a){this.buffer[this.tail]=a;this.tail=(this.tail+1)%this.size;this.length<this.size?this.length++:this.head=(this.head+1)%this.size};CircularBuffer.prototype.getItemsReverse=function(){for(var a=[],b=1;b<=this.length;b++)a.push(this.buffer[(this.tail-b+this.size)%this.size]);return a};
var Particle=function(a,b){this.x=a;this.y=b},NoiseMap=function(){this.nextX=0;this.nextY=9E4;this.x=map(noise(this.nextX),0,.2,0,width);this.y=map(noise(this.nextY),0,.2,0,height);this.py=this.px=0};NoiseMap.prototype.step=function(){this.px=this.x;this.py=this.y;this.x=map(noise(this.nextX),0,1,0,width);this.y=map(noise(this.nextY),0,1,0,height);this.nextX+=.02;this.nextY+=.02;particleBuffer.push(new Particle(this.x,this.y))};
function setup(){createCanvas(400,400);background(0);particleBuffer=new CircularBuffer(particleBufferSize);noiseMap=new NoiseMap;noiseMap.step();strokeWeight(2)}
function draw(){background(0);noiseMap.step();alphaval=255;redval=0;greenval=255;size=30;particles=particleBuffer.getItemsReverse();for(var a=0;a<particles.length;a++)particle=particles[a],0===a?(strokeWeight(0),fill(120,120,255),circle(particle.x,particle.y,size),strokeWeight(2)):(alphaval-=7,redval+=10,greenval-=10,--size,fill(redval,greenval,0,alphaval),circle(particle.x,particle.y,size))};